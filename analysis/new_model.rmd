---
title: Binomial model predictions
date: "`r Sys.Date()`"
author: "fredcallaway"
output:
  rmdformats::robobook:
    code_folding: hide
    self_contained: true
---

```{r setup, include=FALSE}
source("setup.r")

read_sim = function(name) {
    read_csv(glue("../model/results/sim_{name}.csv")) %>% mutate(name=!!name)
}

raw_df = bind_rows(read_sim("optimal"), read_sim("random")) 
```

```{r}
both_models = raw_df %>% mutate(
    strength_first = scale(scale(strength_first) + rnorm(nrow(raw_df), sd=5)),
    strength_second = scale(scale(strength_second) + rnorm(nrow(raw_df), sd=5)),
    correct = outcome != -1,
    presentation_times = map(presentation_times, fromJSON),
    rt = duration_first + duration_second,
    prop_first = duration_first / rt,
    rel_present = duration_first - duration_second,
    first_pres_time = map_dbl(presentation_times, 1, .default=NaN),
    second_pres_time = map_dbl(presentation_times, 2, .default=NaN),
    choose_first = outcome == 1,
    n_pres = lengths(presentation_times),
    odd_pres = mod(n_pres, 2) == 1,
    rel_strength = strength_first - strength_second,
    strength_first_bin = cut(strength_first, 5, ordered=T),
    strength_second_bin = cut(strength_second, 5, ordered=T),
    rt=rt*250,
    rel_present=rel_present*250,
    duration_first=duration_first*250,
    duration_second=duration_second*250,
    first_pres_time=first_pres_time*250,
    second_pres_time=second_pres_time*250,
)


optimal = filter(both_models, name=="optimal")
random = filter(both_models, name=="random")
human = read_csv("human_multi.csv")
human$name = "human"
df = bind_rows(both_models, human)

```

## Fixation proportion by relative memory strength
```{r,fig.width=7.5, fig.height=3}
df %>% 
    filter(n_pres >= 2) %>% 
    ggplot(aes(rel_strength, prop_first)) + geom_smooth(se=F) + 
    stat_summary_bin(fun.data=mean_cl_boot, bins=5) + facet_wrap(~name)
```

## First fixation duration by first fixated item strength
```{r,fig.width=7.5, fig.height=3}
df %>% 
    filter(n_pres >= 2) %>% 
    ggplot(aes(strength_first, first_pres_time)) + geom_smooth(se=F) + facet_wrap(~name)
```


## Second fixation duration
```{r,fig.width=7.5, fig.height=3}
df %>% 
    filter(n_pres > 2) %>% 
    ggplot(aes(strength_second, second_pres_time)) + geom_smooth(se=F) + facet_wrap(~name)

df %>% 
    filter(n_pres > 2) %>% 
    ggplot(aes(strength_first, second_pres_time)) + geom_smooth(se=F) + facet_wrap(~name)

```

### Split by which target is remembered

```{r,fig.width=7.5, fig.height=3}
ggplot(df, aes(strength_first, first_pres_time, color=choose_first)) + 
    geom_smooth() + facet_wrap(~name)
```

```{r,fig.width=7.5, fig.height=3}
df %>% ggplot(aes(rel_strength, prop_first, color=factor(outcome), group=factor(outcome))) + 
    geom_smooth() + facet_wrap(~name)
```


## Choice probability

Conditioning on remembering a target, how likely is the first seen one to be remembered?

```{r,fig.width=7.5, fig.height=3}
df %>% filter(correct) %>% mutate(
    strength_first_bin = cut(strength_first, 5, ordered=T)
) %>% ggplot(aes(rel_strength, as.numeric(choose_first), color=strength_first_bin)) +
    geom_smooth(method = "glm", method.args = list(family = "binomial"), formula=y~x, se=F) + facet_wrap(~name) +
    ylab("p(remember first seen)")
```






