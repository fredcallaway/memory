---
title: Cue-selection with overt semantic primes
date: "`r Sys.Date()`"
author: "fredcallaway"
output:
  rmdformats::robobook:
    code_folding: hide
    self_contained: true
---

```{r, include=FALSE}
VERSIONS = c('v9.0', 'v9.1')
knitr::opts_chunk$set(
    fig.path="figs/",
    results='asis', warning=FALSE, message=FALSE, fig.width=5, fig.height=4, fig.align="center"
)
```

## Experiment

It's exactly the same as Experiment 1 except that we provide a semantic
prime for one of the target words before each critical trial (and we 
change the words to support this).

[Here](https://memorygame29.herokuapp.com/?skip=6) is a demonstration of the
prime. It's an overt (300ms on screen without mask) semantic prime. I selected
stimuli using a free-association dataset, picking targets that were very likely
to be produced for given a cue word (the cue becomes our prime). They are not
subtle, e.g. "wick" primes "candle", "teddy" primes "bear".

Going forward, I think we should probably try to soften the prime, ideally
making it subliminal. But I wanted to start by establishing the basic
priming effect.

Version(s): `r paste(VERSIONS)`

## Analysis
```{r setup, echo=FALSE}
OPTIMAL_VERSION = "optimal_prior"
DROP_HALF = FALSE
DROP_ACC = TRUE
DROP_ERROR = TRUE
NORMALIZE_FIXATIONS = TRUE
MIXED_DURATIONS = TRUE
source("setup.r")
source("load_data.r")
if (!MIXED_DURATIONS) info("Using fixed effects models for fixations")

human = human %>% mutate(
    primed = if_else(first_primed, "first", "second"),
)

WIDTH = 3.2
HEIGHT = 3
```

Note: I'm just plotting raw means here, but the regression is still mixed effects.

# Probability of choosing the primed word

Sanity check.

```{r choice, fig.width=WIDTH, fig.height=HEIGHT}
prime_effect = function(data, yvar) {
    data %>% 
        mutate(first_primed = int(first_primed)) %>% 
        tidylmer(first_primed, {{yvar}}) %>% summ %>% smart_print
    data %>% 
        ggplot(aes(primed, {{yvar}})) +
        stat_summary(fun.data=mean_cl_boot) +
        labs(x="Primed", y=pretty_name(ensym(yvar)))
}

human %>% 
    filter(n_pres > 0) %>% 
    mutate(choose_first = int(choose_first)) %>% 
    prime_effect(choose_first)
```

# Overall fixation proportion

```{r overall, fig.width=WIDTH, fig.height=HEIGHT}
human %>%
    filter(n_pres>1) %>% 
    prime_effect(prop_first)
```

# Fixation time course

```{r time-course, fig.width=WIDTH, fig.height=HEIGHT}
normalized_timestep = function(long) {
    long %>% 
        group_by(trial_id) %>%
        # this somewhat complex method ensures that all trials have exactly 100 steps
        # (this isn't true if you just round duration, as I did initially)
        mutate(percentage_complete = round(100*cumsum(duration / sum(duration)))) %>% 
        mutate(n_step = diff(c(0, percentage_complete))) %>% 
        uncount(n_step) %>% 
        group_by(trial_id) %>% 
        mutate(normalized_timestep = row_number())
}
long %>% 
    filter(name == 'Human') %>% 
    left_join(select(human, trial_id, first_primed, version)) %>% 
    mutate(fix_primed = 1*(fix_first == first_primed)) %>% 
    normalized_timestep %>% 
    drop_na(strength_diff) %>% 
    ggplot(aes(normalized_timestep/100, fix_primed)) +
    geom_smooth(se=F) + 
    ylim(0, 1) +
    facet_grid(~name) +
    labs(x="Normalized Time", y="Probability Fixate Primed Cue") +
    geom_hline(yintercept=0.5) +
    theme(legend.position="top")

```

<!-- 
```{r,fig.width=6, fig.height=HEIGHT}
long %>% 
    filter(name == 'Human') %>% 
    filter(strength_diff != "small") %>% 
    filter(between(n_pres, 2, 5)) %>% 
    left_join(select(human, trial_id, first_primed, version, n_pres)) %>% 
    mutate(fix_primed = 1*(fix_first == first_primed)) %>% 
    normalized_timestep %>% 
    drop_na(strength_diff) %>% 
    ggplot(aes(normalized_timestep/100, fix_primed, color=as_factor(n_pres))) +
    geom_smooth(se=F) + 
    ylim(0, 1) +
    facet_grid(~name) +
    labs(x="Normalized Time", y="Probability Fixate Primed Cue") +
    geom_hline(yintercept=0.5) +
    theme(legend.position="right")

```
-->

# Fixation durations

## First fixation

This effect is the opposite of predicted. Something weird is going on,
see the interaction below.

```{r first, fig.width=WIDTH, fig.height=HEIGHT}
human %>%
    filter(n_pres >= 2) %>% 
    prime_effect(first_pres_time)
```

## Second fixation

In the right direction, but small and insignificant.

```{r second, fig.width=WIDTH, fig.height=HEIGHT}
human %>% 
    filter(n_pres >= 3) %>% 
    prime_effect(second_pres_time)
```

## Third fixation

Same thing.

```{r third, fig.width=WIDTH, fig.height=HEIGHT}
human %>% 
    filter(n_pres >= 4) %>% 
    prime_effect(third_pres_time)

```

# Strength-prime interactions

For the most part, we don't see interactions, and the main effect of the prime
sticks around when accounting for strength. The interesting exception is 
first fixation duration.

## Choice

```{r choice-interact, fig.width=4, fig.height=HEIGHT}

prime_interaction = function(data, xvar, yvar) {
    y = ensym(yvar)
    x = ensym(xvar)
    data %>% 
        mutate(first_primed = int(first_primed)) %>% 
        lm(inject(!!y ~ !!x * first_primed), data=.) %>% 
        summ %>% smart_print
    data %>% 
        ggplot(aes({{xvar}}, {{yvar}}, color=primed)) +
        geom_smooth(method='lm') +
        labs(x=pretty_name(x), y=pretty_name(y)) +
        geom_xdensity +
        theme(legend.position="right")
}

human %>%
    filter(n_pres > 0) %>% 
    mutate(choose_first = int(choose_first)) %>% 
    prime_interaction(strength_first, choose_first)
```

## Overall fixation proportion

```{r fix-prop-interact, fig.width=4, fig.height=HEIGHT}

human %>% 
    filter(n_pres > 0) %>% 
    mutate(choose_first = int(choose_first)) %>% 
    prime_interaction(rel_strength, prop_first)
```

## First fixation

We have a strong negative effect of strength on first fixation duration when
the first cue is primed. This is peculiar. I think it's probably some kind of 
selection effect. Something like... if people have a strong memory for a primed
item, the only way they could not remember it is if they mistakenly switch away
quickly. Alternatively, participants could be using a strategy where they remember
the first target but look at the second image to double check that the first image
is actually the right cue. Note that with the explicit prime, people could know
the target before even seeing a cue (this is a problem with the explicit prime).

```{r firsd-interact, fig.width=4, fig.height=HEIGHT}
human %>%
    filter(n_pres >= 2) %>% 
    prime_interaction(strength_first, first_pres_time)
```

## Second fixation

```{r second-interact, fig.width=4, fig.height=HEIGHT}
human %>% 
    filter(n_pres >= 3) %>% 
    prime_interaction(rel_strength, second_pres_time)
```

## Third fixation

```{r third-interact, fig.width=4, fig.height=HEIGHT}
human %>% 
    filter(n_pres >= 4) %>% 
    prime_interaction(rel_strength, third_pres_time)
```


# Miscellaneous


## Awareness

We ask: "Did you notice anything about the letters that flashed in the last test round?"

```{r}
survey = load_data('survey') 
survey %>% 
    left_join(select(participants, wid, version)) %>% 
    select(Q0) %>% kable
```

## Response types

We see a similar accuracy rate to Experiment 1.

```{r}
raw_df %>% 
    with((proportions(table(name, response_type), margin=1))) %>% 
    kable(digits=2)
```

## Reaction time

Similar as well.

```{r rt, fig.width=WIDTH, fig.height=HEIGHT}
human %>% 
    ggplot(aes(rt)) +
    geom_density() +
    facet_grid(~name) +
    labs(x="Reaction Time", y="Density")
```

## Number of fixations

Similar.

```{r nfix}
human %>% 
    filter(n_pres < 10) %>% 
    ggplot(aes(n_pres, ..prop..)) +
    geom_bar() +
    facet_grid(~name) +
    labs(x="Number of Fixations", y="Proportion of Trials")
```
